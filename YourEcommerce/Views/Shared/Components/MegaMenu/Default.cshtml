@using YourEcommerce.ViewModels
@model YourEcommerce.ViewModels.MegaMenuViewModel

@foreach (var genderGroup in Model.MenuStructure.OrderBy(g => g.Key.Id))
{
    var gender = genderGroup.Key;
    var categories = genderGroup.Value;
    
    <div id="mega-menu-full-cta-dropdown-@gender.Id" class="z-100 absolute w-full hidden bg-white shadow-xs dark:bg-gray-900 animate__animated animate__fadeIn animate__faster p-8">
        <div class="flex justify-center gap-15 max-w-screen-xl px-4 pb-5 mx-auto text-sm text-gray-500 dark:text-gray-400">
            @foreach (var category in categories)
            {

                <ul class="space-y-4 w-50" aria-labelledby="mega-menu-full-cta-button">
                    <button class="cursor-pointer w-full text-start mb-4 py-2 pr-2 text-base font-medium text-gray-900 border-b-2 border-black-100 hover:bg-gray-50 dark:text-white dark:hover:bg-gray-700 md:dark:hover:bg-transparent dark:border-gray-700 tracking-wide">
                        @category.Key
                    </button>

                    @foreach (var tag in category.Value)
                    {
                        <li>
                            <a href="#" class="font-medium hover:text-black dark:hover:text-white pl-2">
                                @tag
                            </a>
                        </li>
                    }
                </ul>
            }
        </div>
    </div>
}

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const genders = [@string.Join(", ", Model.MenuStructure.Keys.Select(g => g.Id))];

        genders.forEach(genderId => {
            const button = document.getElementById(`mega-menu-full-cta-dropdown-button-${genderId}`);
            const menu = document.getElementById(`mega-menu-full-cta-dropdown-${genderId}`);

            let timeout;

            const showMenu = () => {
                clearTimeout(timeout);
                menu.classList.remove('hidden');
            };

            const hideMenu = () => {
                timeout = setTimeout(() => {
                    menu.classList.add('hidden');
                }, 150);
            };

            if (button && menu) {
                button.addEventListener('mouseenter', showMenu);
                button.addEventListener('mouseleave', hideMenu);
                menu.addEventListener('mouseenter', showMenu);
                menu.addEventListener('mouseleave', hideMenu);
            }
        });
    });
</script>